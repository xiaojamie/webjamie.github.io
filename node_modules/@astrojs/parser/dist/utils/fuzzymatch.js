var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __markAsModule = (target) => __defProp(target, "__esModule", { value: true });
var __export = (target, all) => {
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};
var __reExport = (target, module2, copyDefault, desc) => {
  if (module2 && typeof module2 === "object" || typeof module2 === "function") {
    for (let key of __getOwnPropNames(module2))
      if (!__hasOwnProp.call(target, key) && (copyDefault || key !== "default"))
        __defProp(target, key, { get: () => module2[key], enumerable: !(desc = __getOwnPropDesc(module2, key)) || desc.enumerable });
  }
  return target;
};
var __toCommonJS = /* @__PURE__ */ ((cache) => {
  return (module2, temp) => {
    return cache && cache.get(module2) || (temp = __reExport(__markAsModule({}), module2, 1), cache && cache.set(module2, temp), temp);
  };
})(typeof WeakMap !== "undefined" ? /* @__PURE__ */ new WeakMap() : 0);
var fuzzymatch_exports = {};
__export(fuzzymatch_exports, {
  default: () => fuzzymatch
});
function fuzzymatch(name, names) {
  const set = new FuzzySet(names);
  const matches = set.get(name);
  return matches && matches[0] && matches[0][0] > 0.7 ? matches[0][1] : null;
}
const GRAM_SIZE_LOWER = 2;
const GRAM_SIZE_UPPER = 3;
function _distance(str1, str2) {
  if (str1 === null && str2 === null) {
    throw "Trying to compare two null values";
  }
  if (str1 === null || str2 === null)
    return 0;
  str1 = String(str1);
  str2 = String(str2);
  const distance = levenshtein(str1, str2);
  if (str1.length > str2.length) {
    return 1 - distance / str1.length;
  } else {
    return 1 - distance / str2.length;
  }
}
function levenshtein(str1, str2) {
  const current = [];
  let prev;
  let value;
  for (let i = 0; i <= str2.length; i++) {
    for (let j = 0; j <= str1.length; j++) {
      if (i && j) {
        if (str1.charAt(j - 1) === str2.charAt(i - 1)) {
          value = prev;
        } else {
          value = Math.min(current[j], current[j - 1], prev) + 1;
        }
      } else {
        value = i + j;
      }
      prev = current[j];
      current[j] = value;
    }
  }
  return current.pop();
}
const non_word_regex = /[^\w, ]+/;
function iterate_grams(value, gram_size = 2) {
  const simplified = "-" + value.toLowerCase().replace(non_word_regex, "") + "-";
  const len_diff = gram_size - simplified.length;
  const results = [];
  if (len_diff > 0) {
    for (let i = 0; i < len_diff; ++i) {
      value += "-";
    }
  }
  for (let i = 0; i < simplified.length - gram_size + 1; ++i) {
    results.push(simplified.slice(i, i + gram_size));
  }
  return results;
}
function gram_counter(value, gram_size = 2) {
  const result = {};
  const grams = iterate_grams(value, gram_size);
  let i = 0;
  for (i; i < grams.length; ++i) {
    if (grams[i] in result) {
      result[grams[i]] += 1;
    } else {
      result[grams[i]] = 1;
    }
  }
  return result;
}
function sort_descending(a, b) {
  return b[0] - a[0];
}
class FuzzySet {
  constructor(arr) {
    this.exact_set = {};
    this.match_dict = {};
    this.items = {};
    for (let i = GRAM_SIZE_LOWER; i < GRAM_SIZE_UPPER + 1; ++i) {
      this.items[i] = [];
    }
    for (let i = 0; i < arr.length; ++i) {
      this.add(arr[i]);
    }
  }
  add(value) {
    const normalized_value = value.toLowerCase();
    if (normalized_value in this.exact_set) {
      return false;
    }
    let i = GRAM_SIZE_LOWER;
    for (i; i < GRAM_SIZE_UPPER + 1; ++i) {
      this._add(value, i);
    }
  }
  _add(value, gram_size) {
    const normalized_value = value.toLowerCase();
    const items = this.items[gram_size] || [];
    const index = items.length;
    items.push(0);
    const gram_counts = gram_counter(normalized_value, gram_size);
    let sum_of_square_gram_counts = 0;
    let gram;
    let gram_count;
    for (gram in gram_counts) {
      gram_count = gram_counts[gram];
      sum_of_square_gram_counts += Math.pow(gram_count, 2);
      if (gram in this.match_dict) {
        this.match_dict[gram].push([index, gram_count]);
      } else {
        this.match_dict[gram] = [[index, gram_count]];
      }
    }
    const vector_normal = Math.sqrt(sum_of_square_gram_counts);
    items[index] = [vector_normal, normalized_value];
    this.items[gram_size] = items;
    this.exact_set[normalized_value] = value;
  }
  get(value) {
    const normalized_value = value.toLowerCase();
    const result = this.exact_set[normalized_value];
    if (result) {
      return [[1, result]];
    }
    let results = [];
    for (let gram_size = GRAM_SIZE_UPPER; gram_size >= GRAM_SIZE_LOWER; --gram_size) {
      results = this.__get(value, gram_size);
      if (results) {
        return results;
      }
    }
    return null;
  }
  __get(value, gram_size) {
    const normalized_value = value.toLowerCase();
    const matches = {};
    const gram_counts = gram_counter(normalized_value, gram_size);
    const items = this.items[gram_size];
    let sum_of_square_gram_counts = 0;
    let gram;
    let gram_count;
    let i;
    let index;
    let other_gram_count;
    for (gram in gram_counts) {
      gram_count = gram_counts[gram];
      sum_of_square_gram_counts += Math.pow(gram_count, 2);
      if (gram in this.match_dict) {
        for (i = 0; i < this.match_dict[gram].length; ++i) {
          index = this.match_dict[gram][i][0];
          other_gram_count = this.match_dict[gram][i][1];
          if (index in matches) {
            matches[index] += gram_count * other_gram_count;
          } else {
            matches[index] = gram_count * other_gram_count;
          }
        }
      }
    }
    const vector_normal = Math.sqrt(sum_of_square_gram_counts);
    let results = [];
    let match_score;
    for (const match_index in matches) {
      match_score = matches[match_index];
      results.push([match_score / (vector_normal * items[match_index][0]), items[match_index][1]]);
    }
    results.sort(sort_descending);
    let new_results = [];
    const end_index = Math.min(50, results.length);
    for (let j = 0; j < end_index; ++j) {
      new_results.push([_distance(results[j][1], normalized_value), results[j][1]]);
    }
    results = new_results;
    results.sort(sort_descending);
    new_results = [];
    for (let j = 0; j < results.length; ++j) {
      if (results[j][0] == results[0][0]) {
        new_results.push([results[j][0], this.exact_set[results[j][1]]]);
      }
    }
    return new_results;
  }
}
module.exports = __toCommonJS(fuzzymatch_exports);
// Annotate the CommonJS export names for ESM import in node:
0 && (module.exports = {});
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsiLi4vLi4vc3JjL3V0aWxzL2Z1enp5bWF0Y2gudHMiXSwKICAibWFwcGluZ3MiOiAiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFHZSxvQkFBb0IsTUFBYyxPQUFpQjtBQUNqRSxRQUFNLE1BQU0sSUFBSSxTQUFTLEtBQUs7QUFDOUIsUUFBTSxVQUFVLElBQUksSUFBSSxJQUFJO0FBRTVCLFNBQU8sV0FBVyxRQUFRLE1BQU0sUUFBUSxHQUFHLEtBQUssTUFBTSxRQUFRLEdBQUcsS0FBSztBQUN2RTtBQUtBLE1BQU0sa0JBQWtCO0FBQ3hCLE1BQU0sa0JBQWtCO0FBR3hCLG1CQUFtQixNQUFjLE1BQWM7QUFDOUMsTUFBSSxTQUFTLFFBQVEsU0FBUyxNQUFNO0FBQ25DLFVBQU07QUFBQSxFQUNQO0FBQ0EsTUFBSSxTQUFTLFFBQVEsU0FBUztBQUFNLFdBQU87QUFDM0MsU0FBTyxPQUFPLElBQUk7QUFDbEIsU0FBTyxPQUFPLElBQUk7QUFFbEIsUUFBTSxXQUFXLFlBQVksTUFBTSxJQUFJO0FBQ3ZDLE1BQUksS0FBSyxTQUFTLEtBQUssUUFBUTtBQUM5QixXQUFPLElBQUksV0FBVyxLQUFLO0FBQUEsRUFDNUIsT0FBTztBQUNOLFdBQU8sSUFBSSxXQUFXLEtBQUs7QUFBQSxFQUM1QjtBQUNEO0FBR0EscUJBQXFCLE1BQWMsTUFBYztBQUNoRCxRQUFNLFVBQW9CLENBQUM7QUFDM0IsTUFBSTtBQUNKLE1BQUk7QUFFSixXQUFTLElBQUksR0FBRyxLQUFLLEtBQUssUUFBUSxLQUFLO0FBQ3RDLGFBQVMsSUFBSSxHQUFHLEtBQUssS0FBSyxRQUFRLEtBQUs7QUFDdEMsVUFBSSxLQUFLLEdBQUc7QUFDWCxZQUFJLEtBQUssT0FBTyxJQUFJLENBQUMsTUFBTSxLQUFLLE9BQU8sSUFBSSxDQUFDLEdBQUc7QUFDOUMsa0JBQVE7QUFBQSxRQUNULE9BQU87QUFDTixrQkFBUSxLQUFLLElBQUksUUFBUSxJQUFJLFFBQVEsSUFB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
